<!--
 * @Date: 2024-06-02
 * @LastEditors: GoKo-Son626
 * @LastEditTime: 2024-06-02
 * @FilePath: \STM32_Study\基础篇\认识HAL库.md
 * @Description: 
-->
### 认识HAL库

##### 初识HAL库

1. CMSIS简介
> CMSIS（微控制器软件接口标》准）：是由ARM和与其合作的芯片厂商，软件工具厂商，共同制定的标准

| 层次            | 内容               |
| --------------- | ------------------ |
| 用户层          | 用户代码           |
| 中间层（CMSIS） | 包含Peripheral HAL |
| 硬件层          |

2. HAL简介
> ST提供了三种库：
>   - 标准外设库
>   - HAL库（硬件抽象层）
>   - LL库
##### STM32Cube固件包浅析
1. 获取STM32Cube固件包（上一个章节已讲）
2. STM32Cube固件包文件夹简介

| 文件夹名称 | 文件夹名称                | 作用                                             |
| ---------- | ------------------------- | ------------------------------------------------ |
| Drivers    | BAP                       | 班级支持包，用于适配ST官方的开发板               |
| Drivers    | **SIS**                   | 符合CMISI的组件，DSP库，启动文件等               |
| Drivers    | **STM32F1xxx_HAL_Driver** | HAL库外设启动源码，包括F1系列HAL库源文件和头文件 |

Middlewares文件夹

 Drivers/CMSIS/Device/ST/STM32F1中include和Source文件夹中文件重要文件介绍：
| 文件名称                               | 描述                                                                                               |
| -------------------------------------- | -------------------------------------------------------------------------------------------------- |
| stm32f1xx.h                            | 是所有F1系列的顶层头文件，通过条件编译来包含某个芯片的头文件，定义通用的枚举类型，定义通用的宏定义 |
| stm32f103xe.h                          | 包含:中断编号定义、外设寄存器结构体类型定义、寄存器映射奇存器位定义、外设判定                      |
| system_stm32f1xx.c和system_stm32f1xx.h | 定义了系统初始化函数SystemInit和系统时钟更新函数SystemCoreClockUpdate                              |
| startup_stm32f103xe.s                  | 大容量F103系列芯片的启动文件                                                                       |
##### HALk库框架结构

- 文件夹结构：
> - Src(Source):外设驱动源码
> - Inc(Include):外设驱动源码头文件

- HAL库文件介绍
> hal.:初始化等相关函数
> hal_cong.h：用户配置文件
> hal_def.h：通用的枚举类型数据和宏定义
> hal_cortex.：内核通用函数定义和声明
> hal_ppp.(ppp表示外设)：PPP外设驱动源码
> hal_ppp_ex.(特殊功能的驱动源码)：外设特殊的扩展功能的驱动源码
> ll_ppp.：LL库驱动源码，在部分STM32f1xx_hal_ppp.c和STM32f1xx_hal_ppp_ex.c中会被调用

>  _weak函数允许用户重定义

##### 如何使用HAL库

1. Msp在外设.c文件中
2. HAL库的用户配置文件(stm32f1xx_hal_conf.h)
   1. 屏蔽宏或者不参与裁剪（使其不进行编译）
   2. 设置外部高速晶振频率（实际）
   2. 设置外部低速晶振频率（实际）
3. 
##### HAL库使用注意事项

1. 使用HAL库出现问题，还是得通过参考手册检查是否硬件操作是否有问题
2. 尽量不通过修改库源码实现功能，这样不方便库更新
3. HAL库可能会存在错误，要有质疑精神
4. 有些HAL库API函数执行效率偏低，我们可能会直接通过操作寄存器的方式代替